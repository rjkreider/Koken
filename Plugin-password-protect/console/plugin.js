Koken.extend(function(){this.hook("selection.loaded",function(e){if("site"!==this.data().scope&&e&&e.album_type){var a=this,s=this.data().master_password.length,t=[{label:"view",click:function(){window.open(e.url)}},{label:"share",click:function(){var s="";if(e.koken_password_protect){var t=$("span.plugin_"+a.kguid+' input[name="password"]');s=t.val()}else s=e.koken_password_parent_password||a.data().master_password;location.href="mailto:?subject="+encodeURIComponent(e.title)+'&body=Hi - Check%20out%20the%20"'+encodeURIComponent(e.title)+'"%20album%20at%20the%20link%20below.%20Note%20that%20a%20password%20is%20required%20to%20view%20this%20album.%0D%0A%0D%0A'+e.url+"%0D%0A%0D%0APassword: "+s}}],o="Not shareable";e.koken_password_protect?o="Shareable":e.koken_password_parent_password?o="Shareable through parent set":s&&(o="Shareable with master password");var i=[{label:"Status",type:"text",value:o,key:"status"},{label:"Site link",type:"site_link",value:e.url,hide:!e.koken_password_parent_password&&0===this.data().master_password.length&&!e.koken_password_protect,links:t},{label:this.data().master_password.length||e.koken_password_parent_password?" Assign additional password":" Share with a password",key:"viewable_with_password",type:"boolean",value:e.koken_password_protect},{label:"Password",key:"password",type:"string",value:e.koken_password_protect_password,hide:!e.koken_password_protect}];this.render("koken.library.albumSidebar",{appendAfter:"site",sections:[{label:"Password protection",visibility:"private"===e.visibility||"private"===e.visibility.raw,fields:i}]},function(e,s){function t(e){e=e||!1;var a=o.is(":checked"),t=i.val(),n={koken_password_protect:a,koken_password_protect_password:t};a&&i.focus(),n.allow_max_download=a,s.save(n,e)}var o=$("span.plugin_"+a.kguid+' input[name="viewable_with_password"]'),i=($("span.plugin_"+a.kguid+' select[name="viewable_with_password"]'),$("span.plugin_"+a.kguid+' input[name="password"]'));$("span.plugin_"+a.kguid+" textarea"),i.parents(".col-row"),$("span.plugin_"+a.kguid+" span.status-text");$(document).off(".passwordKeyup").on("blur.passwordKeyup","span.plugin_"+this.kguid+' input[type="text"]',function(){t(!0)}),$(document).off(".passwordCheckboxSettings").on("change.passwordCheckboxSettings","span.plugin_"+this.kguid+' input[type="checkbox"]',function(){requestAnimationFrame(t)})})}})});