Koken.extend(function(){function e(e){var a={ALL:"Lek",AFN:"؋",ARS:"$",AWG:"ƒ",AUD:"$",AZN:"ман",BSD:"$",BBD:"$",BYN:"Br",BZD:"BZ$",BMD:"$",BOB:"$b",BAM:"KM",BWP:"P",BGN:"лв",BRL:"R$",BND:"$",KHR:"៛",CAD:"$",KYD:"$",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",HRK:"kn",CUP:"₱",CZK:"Kč",DKK:"kr",DOP:"RD$",XCD:"$",EGP:"£",SVC:"$",EUR:"€",FKP:"£",FJD:"$",GHS:"¢",GIP:"£",GTQ:"Q",GGP:"£",GYD:"$",HNL:"L",HKD:"$",HUF:"Ft",ISK:"kr",IDR:"Rp",IRR:"﷼",IMP:"£",ILS:"₪",JMD:"J$",JPY:"¥",JEP:"£",KZT:"лв",KPW:"₩",KRW:"₩",KGS:"лв",LAK:"₭",LBP:"£",LRD:"$",MKD:"ден",MYR:"RM",MUR:"₨",MXN:"$",MNT:"₮",MZN:"MT",NAD:"$",NPR:"₨",ANG:"ƒ",NZD:"$",NIO:"C$",NGN:"₦",KPW:"₩",NOK:"kr",OMR:"﷼",PKR:"₨",PAB:"B/.",PYG:"Gs",PEN:"S/.",PHP:"₱",PLN:"zł",QAR:"﷼",RON:"lei",RUB:"руб",SHP:"£",SAR:"﷼",RSD:"Дин.",SCR:"₨",SGD:"$",SBD:"$",SOS:"S",ZAR:"R",KRW:"₩",LKR:"₨",SEK:"kr",CHF:"CHF",SRD:"$",SYP:"£",TWD:"NT$",THB:"฿",TTD:"TT$",TVD:"$",UAH:"₴",GBP:"£",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",YER:"﷼",ZWD:"Z$"};return a[e]||""}function a(){$("div.dependent").each(function(e,a){var t=ko.dataFor(a),n=$(a),i=!0;if(t.dependencies&&t.dependencies.conditions){var r="all"===t.dependencies.evaluate;$.each(t.dependencies.conditions,function(e,a){var t=$("#plugin_"+a.option);if(t.length){var n=t.val();"checkbox"===t.attr("type")?n=t.is(":checked"):/^(true|false)$/.test(n)&&(n="true"===n);var s=a.hasOwnProperty("equals")&&a.equals||a.hasOwnProperty("not")&&a.not||a.hasOwnProperty("greater_than")&&a.greater_than||a.hasOwnProperty("less_than")&&a.less_than;return"true"===s?s=!0:"false"===s&&(s=!1),i=!(!t.is(":visible")&&"hidden"!==t.prop("type")||!(a.hasOwnProperty("equals")&&n==s||a.hasOwnProperty("not")&&n!=s||a.hasOwnProperty("greater_than")&&n>s||a.hasOwnProperty("less_than")&&n<s)),!(i&&!r||!i&&r)&&void 0}})}i?n.show():n.hide()})}function t(e){if(!e[0].album_type){var a=this.data();this.render("koken.library.multiSidebar",{sections:[{label:"Cart",visibility:"some"===a.koken_cart_purchasable,fields:[{label:"Purchasable",key:"purchasable",type:"boolean",control_first:!1,value:!0,visibility:!0}]}]},function(e,a){var t=$("span.plugin_"+this.kguid+' input[name="purchasable"]');$.each(a,function(e,a){if(!a.koken_cart_data||!JSON.parse(a.koken_cart_data).purchasable)return t.prop("checked",!1),!1}),$(document).off(".cartSettings").on("change.cartSettings input.cartSettings","span.plugin_"+this.kguid,function(e){requestAnimationFrame(function(){var e={purchasable:t.is(":checked")?1:0};$.each(a,function(a,t){var n=JSON.parse(t.koken_cart_data),i=$.extend({},n,e);t.save({koken_cart_data:JSON.stringify(i)})})})})})}}var n;this.hook("selection.loaded",function(i){if($.isArray(i))return t.call(this,i);if(i&&void 0!==i.koken_cart_data){var r=[],s=this.data(),c=i.koken_cart_data?JSON.parse(i.koken_cart_data):{};if("number"!==document.activeElement.type||!n||n!==i.internal_id){if(n=i.internal_id,(s.koken_cart_digital||s.koken_cart_custom_variants)&&r.push({hide:"some"!==s.koken_cart_purchasable,label:"Purchasable",key:"purchasable",type:"boolean",control_first:!1,value:c.purchasable}),s.koken_cart_digital&&r.push({label:"Digital Price",key:"digital_price",type:"number",min:0,value:c.digital_price,placeholder:s.koken_cart_digital_price,suffix:e(s.koken_cart_currency),dependencies:"some"===s.koken_cart_purchasable?{evaluate:"all",conditions:[{option:"purchasable",equals:!0}]}:{}}),s.koken_cart_custom_variants){var o=0;$.each(s,function(a,t){var n,i=a.match(/^koken_cart_variant_description_([0-9]+)$/);i&&2===i.length&&i[1]==o+1&&t.length&&(o=parseInt(i[1],10),c.variants&&$.each(c.variants,function(){if(o===this.id)return n=this.price,!1}),r.push({label:t,key:"variant_price_"+o,type:"number",min:0,value:n,placeholder:s["koken_cart_variant_price_"+o],suffix:e(s.koken_cart_currency),dependencies:"some"===s.koken_cart_purchasable?{evaluate:"all",conditions:[{option:"purchasable",equals:!0}]}:{}}))})}r.length&&this.render("koken.library.sidebar",{sections:[{label:"Cart",visibility:"none"!==s.koken_cart_purchasable,fields:r}]},function(e,t){var n=this;a(),$(document).off(".cartSettings").on("change.cartSettings input.cartSettings","span.plugin_"+this.kguid,function(e){requestAnimationFrame(function(){var e={purchasable:$("span.plugin_"+n.kguid+' input[name="purchasable"]').is(":checked")?1:0},a=$("span.plugin_"+n.kguid+' input[name="digital_price"]').val();""!==a&&(e.digital_price=parseInt(a,10));var i=[];$("span.plugin_"+n.kguid+' input[name^="variant_price_"]').each(function(){var e=this.value;""!==e&&i.push({id:parseInt(this.name.match(/_([0-9]+)$/)[1],10),price:parseInt(e,10)})}),i.length&&(e.variants=i),t.save({koken_cart_data:JSON.stringify(e)})})})})}}})});